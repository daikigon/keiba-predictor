# 中央競馬予想アプリ 要件定義書

## 1. プロジェクト概要

中央競馬のデータをスクレイピングで取得し、機械学習を用いてレース結果を予想するWebアプリケーション。

## 2. 機能要件

### 2.1 データ取得機能（スクレイピング）

- **データソース**: netkeiba
- **取得対象データ**:
  - レース情報（日時、コース、距離、天候、馬場状態など）
  - 出走馬情報（馬名、馬齢、性別、斤量など）
  - 過去成績（着順、タイム、通過順位など）
  - 騎手情報（騎手名、勝率、連対率など）
  - 調教師情報
  - オッズ情報（単勝、複勝、馬連など）
  - 調教タイム
  - 血統情報
  - コース適性

### 2.2 予想機能

- **予想方式**: 機械学習モデル
- **想定アルゴリズム**:
  - LightGBM / XGBoost（勾配ブースティング）
  - ランダムフォレスト
  - ニューラルネットワーク（オプション）
- **出力形式**:
  - 各馬の予想着順
  - 予想確率・スコア
  - 推奨買い目

### 2.3 予想履歴機能

- 過去の予想結果を保存
- 予想と実際の結果を比較
- 的中率・回収率の集計表示
- モデルの精度推移グラフ

### 2.4 その他機能

- 開催レース一覧表示
- 出走馬詳細情報表示
- データ更新機能（手動/自動）

## 3. 非機能要件

### 3.1 利用者

- 個人利用（自分のみ）
- ユーザー認証機能は不要

### 3.2 技術スタック

| レイヤー | 技術 |
|---------|------|
| フロントエンド | Next.js (TypeScript) |
| バックエンド | Python (FastAPI) |
| 機械学習 | scikit-learn, LightGBM |
| スクレイピング | BeautifulSoup / Selenium |
| データベース | PostgreSQL |
| ORM | SQLAlchemy |

### 3.3 システム構成

```
+------------------+     +------------------+
|   Next.js        |---->|   FastAPI        |
|   (Frontend)     |<----|   (Backend)      |
+------------------+     +--------+---------+
                                  |
                    +-------------+-------------+
                    v             v             v
              +----------+ +----------+ +----------+
              | Database | | ML Model | | Scraper  |
              +----------+ +----------+ +----------+
```

## 4. 画面一覧（想定）

| 画面名 | 概要 |
|--------|------|
| ダッシュボード | 本日の開催レース一覧、直近の予想結果 |
| レース詳細 | 出走馬情報、予想結果、オッズ表示 |
| 予想履歴 | 過去の予想一覧、的中率・回収率表示 |
| データ管理 | スクレイピング実行、データ更新状況 |

## 5. 開発フェーズ（案）

### Phase 1: 基盤構築
- プロジェクトセットアップ
- スクレイピング機能実装
- データベース設計・構築

### Phase 2: 機械学習
- 特徴量エンジニアリング
- モデル学習・評価
- 予測API実装

### Phase 3: フロントエンド
- 画面実装
- API連携
- 予想履歴機能

### Phase 4: 運用・改善
- 自動データ更新
- モデル再学習の仕組み
- パフォーマンス改善

## 6. 注意事項

- netkeibaの利用規約を確認し、スクレイピングは適切な間隔で実行すること
- 取得データは個人利用の範囲内で使用すること
- 予想はあくまで参考情報であり、馬券購入は自己責任で行うこと
